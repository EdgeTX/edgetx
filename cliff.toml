# Configuration for git-cliff changelog generation
# https://git-cliff.org/docs/configuration

[changelog]
header = ""
body = """
{% for group, commits in commits | group_by(attribute="group") %}
### {{ group }}
{% for commit in commits -%}
- {{ commit.message | split(pat="\\n") | first | trim }}
{% endfor %}
{% endfor -%}
"""
trim = true

[git]
conventional_commits = true
filter_unconventional = false

# Only look for nightly, release and rc tags
tag_pattern = "^(nightly|v[0-9]+\\.[0-9]+\\.[0-9]+(-rc[0-9]+)?)$"

# Ensures it looks at the branch structure
topo_order = true

# Repect the nearest tag on current branch
use_branch_tags = true

# Ensure it sorts from the tag forward
sort_commits = "oldest"

# Commit parsers - order matters! More specific patterns first
commit_parsers = [
  # Scope-based categorization (highest priority)
  { message = "^feat\\(bw\\)", group = "ğŸ–¥ï¸ Black & White Radio Changes" },
  { message = "^fix\\(bw\\)", group = "ğŸ–¥ï¸ Black & White Radio Changes" },
  { message = "^feat\\(color\\)", group = "ğŸ¨ Color Radio Changes" },
  { message = "^fix\\(color\\)", group = "ğŸ¨ Color Radio Changes" },
  { message = "^feat\\((firmware|fw)\\)", group = "ğŸ® Firmware (All Radios Generally)" },
  { message = "^fix\\((firmware|fw)\\)", group = "ğŸ® Firmware (All Radios Generally)" },
  { message = "^feat\\(cpn\\)", group = "ğŸ’» Companion Software Changes" },
  { message = "^fix\\(cpn\\)", group = "ğŸ’» Companion Software Changes" },

  # Type-based categorization (fallback)
  { message = "^feat", group = "ğŸš€ Features" },
  { message = "^fix", group = "ğŸ› Fixes" },
  { message = "^docs?", group = "ğŸ“ Documentation" },
  { message = "^perf", group = "âš¡ Performance" },
  { message = "^refactor", group = "ğŸ”¨ Refactoring" },
  { message = "^style", group = "ğŸ¨ Style" },
  { message = "^test", group = "ğŸ§ª Tests" },
  { message = "^chore", group = "ğŸ§¹ Chores" },
  { message = "^ci", group = "ğŸ”§ CI/CD" },

  # Everything else
  { body = ".*", group = "ğŸ“¦ Other" },
]
