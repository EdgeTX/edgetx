#!/bin/bash

# ARGV0 is what the AppImage was called as (includes symlink name)
# APPDIR is set by AppImage runtime to the mount point
CALLED_AS="$(basename "${ARGV0}")"

CALLED_AS_LOWER="${CALLED_AS,,}"  # converts to lowercase

# Check if called via symlink with "simulator" in name
if [[ "$CALLED_AS_LOWER" == *"simulator"* ]]; then
    exec "${APPDIR}/usr/bin/@SIMULATOR_NAME@" "$@"
fi

# Check for command-line parameter
case "$1" in
    --simulator)
        shift
        exec "${APPDIR}/usr/bin/@SIMULATOR_NAME@" "$@"
        ;;
    --help)
        echo "Usage: $0 [OPTIONS]"
        echo "  (no options)     Launch Companion"
        echo "  --simulator      Launch Simulator"
        echo "  Or create a symlink with 'simulator' in the name"
        exit 0
        ;;
    *)
        exec "${APPDIR}/usr/bin/@COMPANION_NAME@" "$@"
        ;;
esac
